name: Build firmware - All Dagoma variants

on:
  pull_request:
    branches:
      - DE200-2.1.x
    paths:
      - '.github/workflows/build_*.yaml'
      - 'Marlin/**'
  push:
    branches:
      - DE200-2.1.x
    paths:
      - '.github/workflows/build_*.yaml'
      - 'Marlin/**'
  release:
    types:
      - published
  workflow_dispatch:

jobs:
  basic:
    strategy:
      fail-fast: false
      matrix:
        lang:         [en]
        screen:       [STD]
        extruder:     [STD]
        zscrews:      [STD]
        size:         [STD]
        warping:      [STD]
        thermistor:   [WHITE]
        pinout:       [STD]
        head:         [STD]
        experimental: [NONE, BED_BILINEAR, BED_UNIFIED, LIN_ADV, INP_SHAPE, S_CURVE, MPC, JUNC_DEV]
    permissions:
      contents: write
    name: "Build: ${{ github.job }}"
    uses: ./.github/workflows/build_single.yaml
    with:
      lang:         ${{ matrix.lang }}
      screen:       ${{ matrix.screen }}
      extruder:     ${{ matrix.extruder }}
      zscrews:      ${{ matrix.zscrews }}
      size:         ${{ matrix.size }}
      warping:      ${{ matrix.warping }}
      thermistor:   ${{ matrix.thermistor }}
      pinout:       ${{ matrix.pinout }}
      head:         ${{ matrix.head }}
      experimental: ${{ matrix.experimental }}
    secrets: inherit

  en:
    if: ${{ github.event_name == 'release' }}
    needs: basic
    strategy:
      fail-fast: false
      matrix:
        lang:         [en]
        screen:       [STD]
        extruder:     [STD, PLUS, BICOLOR]
        zscrews:      [STD, EXPERT]
        size:         [STD, XL]
        warping:      [STD, BED_ATELIER3D]
        thermistor:   [WHITE, BLACK]
        pinout:       [STD, MKS]
        head:         [STD, Z122]
        experimental: [NONE]
        exclude:
          - pinout:   MKS       # Pinout for Extruder 2 not defined in standard MKS_BASE_1.5
            extruder: BICOLOR
          - extruder:     STD
            zscrews:      STD
            size:         STD
            warping:      STD
            thermistor:   WHITE
            pinout:       STD
            head:         STD
    permissions:
      contents: write
    name: "Build: ${{ github.job }}"
    uses: ./.github/workflows/build_single.yaml
    with:
      lang:         ${{ matrix.lang }}
      screen:       ${{ matrix.screen }}
      extruder:     ${{ matrix.extruder }}
      zscrews:      ${{ matrix.zscrews }}
      size:         ${{ matrix.size }}
      warping:      ${{ matrix.warping }}
      thermistor:   ${{ matrix.thermistor }}
      pinout:       ${{ matrix.pinout }}
      head:         ${{ matrix.head }}
      experimental: ${{ matrix.experimental }}
    secrets: inherit

  fr:
    if: ${{ github.event_name == 'release' }}
    needs: basic
    strategy:
      fail-fast: false
      matrix:
        lang:         [fr]
        screen:       [STD]
        extruder:     [STD, PLUS, BICOLOR]
        zscrews:      [STD, EXPERT]
        size:         [STD, XL]
        warping:      [STD, BED_ATELIER3D]
        thermistor:   [WHITE, BLACK]
        pinout:       [STD, MKS]
        head:         [STD, Z122]
        experimental: [NONE]
        exclude:
          - pinout:   MKS
            extruder: BICOLOR   # Pinout for Extruder 2 not defined in standard MKS_BASE_1.5
    permissions:
      contents: write
    name: "Build: ${{ github.job }}"
    uses: ./.github/workflows/build_single.yaml
    with:
      lang:         ${{ matrix.lang }}
      screen:       ${{ matrix.screen }}
      extruder:     ${{ matrix.extruder }}
      zscrews:      ${{ matrix.zscrews }}
      size:         ${{ matrix.size }}
      warping:      ${{ matrix.warping }}
      thermistor:   ${{ matrix.thermistor }}
      pinout:       ${{ matrix.pinout }}
      head:         ${{ matrix.head }}
      experimental: ${{ matrix.experimental }}
    secrets: inherit

  de:
    if: ${{ github.event_name == 'release' }}
    needs: basic
    strategy:
      fail-fast: false
      matrix:
        lang:         [de]
        screen:       [STD]
        extruder:     [STD, PLUS, BICOLOR]
        zscrews:      [STD, EXPERT]
        size:         [STD, XL]
        warping:      [STD, BED_ATELIER3D]
        thermistor:   [WHITE, BLACK]
        pinout:       [STD, MKS]
        head:         [STD, Z122]
        experimental: [NONE]
        exclude:
          - pinout:   MKS
            extruder: BICOLOR   # Pinout for Extruder 2 not defined in standard MKS_BASE_1.5
    permissions:
      contents: write
    name: "Build: ${{ github.job }}"
    uses: ./.github/workflows/build_single.yaml
    with:
      lang:         ${{ matrix.lang }}
      screen:       ${{ matrix.screen }}
      extruder:     ${{ matrix.extruder }}
      zscrews:      ${{ matrix.zscrews }}
      size:         ${{ matrix.size }}
      warping:      ${{ matrix.warping }}
      thermistor:   ${{ matrix.thermistor }}
      pinout:       ${{ matrix.pinout }}
      head:         ${{ matrix.head }}
      experimental: ${{ matrix.experimental }}
    secrets: inherit

  noscreen:
    strategy:
      fail-fast: false
      matrix:
        lang:         [en]
        screen:       [NONE]
        extruder:     [STD]
        zscrews:      [STD]
        size:         [STD]
        warping:      [STD, BED_ATELIER3D]
        thermistor:   [WHITE, BLACK]
        pinout:       [STD]
        head:         [STD]
        experimental: [NONE]
    permissions:
      contents: write
    name: "Build: ${{ github.job }}"
    uses: ./.github/workflows/build_single.yaml
    with:
      lang:         ${{ matrix.lang }}
      screen:       ${{ matrix.screen }}
      extruder:     ${{ matrix.extruder }}
      zscrews:      ${{ matrix.zscrews }}
      size:         ${{ matrix.size }}
      warping:      ${{ matrix.warping }}
      thermistor:   ${{ matrix.thermistor }}
      pinout:       ${{ matrix.pinout }}
      head:         ${{ matrix.head }}
      experimental: ${{ matrix.experimental }}
    secrets: inherit

  # lesimprimantes3d:
    # if: ${{ github.event_name == 'release' }}
    # needs: basic
    # strategy:
      # fail-fast: false
      # matrix:
        # lang:       [fr]
        # screen:     [STD]
        # extruder:   [MK8]
        # zscrews:    [T8_8]
        # size:       [STD]
        # warping:    [BED_ATELIER3D]
        # thermistor: [WHITE]
        # pinout:     [MKS]
        # head:       [STD-BLTOUCH]
        # exclude:
          # - pinout: MKS
            # extruder: BICOLOR   # Pinout for Extruder 2 not defined in standard MKS_BASE_1.5
    # permissions:
      # contents: write
    # name: "Build: ${{ github.job }}"
    # uses: ./.github/workflows/build_single.yaml
    # with:
      # lang:       ${{ matrix.lang }}
      # screen:     ${{ matrix.screen }}
      # extruder:   ${{ matrix.extruder }}
      # zscrews:    ${{ matrix.zscrews }}
      # size:       ${{ matrix.size }}
      # warping:    ${{ matrix.warping }}
      # thermistor: ${{ matrix.thermistor }}
      # pinout:     ${{ matrix.pinout }}
      # head:       ${{ matrix.head }}
    # secrets: inherit
